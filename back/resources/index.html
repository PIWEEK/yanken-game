<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Yanken - WebSockets Test Playground</title>
    <style>
     * { font-family: monospace; }
     .buttons {
       display:flex;
       flex-direction: column;
     }

     .buttons button {
       max-width: 300px;
       margin-bottom: 2px;
       cursor: pointer;
     }
    </style>
  </head>
  <body>
    <header>
      <h1>Yanken - WebSockets Test Playground</h1>
    </header>
    <main>
      <section class="buttons">
        <div class="row">
          <button id="echo">CMD: echo</button>
        </div>
        <div class="row">
          <button id="join-room">CMD: join-room</button>
        </div>
        <div class="row">
          <button id="hello">CMD: hello</button>
        </div>
        <div class="row">
          <button id="start-game">CMD: start-game</button>
        </div>
      </section>
    </main>
    <script>
     let sessionId = "s1";
     let currentRequestId = 0;

     function getNextRequestId() {
         return currentRequestId++;
     }

     const ws = new WebSocket("ws://" + location.host);

     function send (msg) {
         if (msg.type === "request") {
             msg.requestId = getNextRequestId();
         }

         const data = JSON.stringify(msg);
         console.log("ws(send):", data);
         ws.send(data);
     };

     ws.addEventListener("open", (event) => {
         console.log("ws(connected)");
     });

     ws.addEventListener("error", (event) => {
         console.log("ws(error):", event);
     })

     ws.addEventListener("close", (event) => {
         console.log("ws(close)", event);
     });

     ws.addEventListener("message", (event) => {
         console.log("ws(received):", event.data);
     });

     const echoBtn = document.getElementById("echo");
     echoBtn.addEventListener("click", (event) => {
         console.log("btn(click): echo");
         send({
             "type": "request",
             "name": "echo",
             "n" : Date.now()
         });
     });

     const joinRoomBtn = document.getElementById("join-room");
     joinRoomBtn.addEventListener("click", (event) => {
         console.log("btn(click): join-room");
         send({
             "type": "request",
             "name": "joinRoom",
             "roomId": "test-room-id"
         });
     });


     const startGame = document.getElementById("start-game");
     startGame.addEventListener("click", (event) => {
         console.log("btn(click): start-game");
         send({
             "type": "request",
             "name": "startGame",
         });
     });


     const helloBtn = document.getElementById("hello");
     helloBtn.addEventListener("click", (event) => {
         console.log("btn(click): hello");
         send({
             "type": "request",
             "name": "hello",
             "roomId": "test-room-id",
             "sessionId": "s1",
             "playerName": "pepito"
         });
     });

    </script>
  </body>
</html>
